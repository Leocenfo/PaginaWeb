<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Transporte - Comunidad Conectada</title>

  <link rel="stylesheet" href="/trabajo_LEO/pagina_404NOTFOUND/css/estilos_Valeria.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
</head>
<body>

<!-- Barra de Navegación -->
<header class="navegacion">
  <img src="/trabajo_LEO/imagenes/friendship-icon-logo-design_586739-5470.jpg" alt="Logo" id="HeaderTableTrTdALogo" class="logo-grande" />
  <div class="divMenu">
    <span id="menuCambio">&#9776;</span>
    <ul id="menu">
      <li><a href="http://127.0.0.1:5501/trabajo_LEO/pagina_404NOTFOUND/HTML/perfiles_Tray/perfil_Tray.HTML">Perfil</a></li>
      <li><a href="http://127.0.0.1:5501/trabajo_LEO/pagina_404NOTFOUND/HTML/anuncios_comunitarios_st/anuncios_ST.HTML">Anuncios</a></li>
      <li><a href="http://127.0.0.1:5501/trabajo_LEO/pagina_404NOTFOUND/HTML/emprendimientos_Marco/empredimientos_Marco.HTML" class="activo">Emprendimientos</a></li>
      <li><a href="http://127.0.0.1:5501/trabajo_LEO/pagina_404NOTFOUND/HTML/emprendimientos_Marco/formulario_emprendimiento.html">Solicitud emprendimiento</a></li>
      <li><a href="http://127.0.0.1:5501/trabajo_LEO/pagina_404NOTFOUND/HTML/eventos_leo/eventos_Leo.HTML">Eventos</a></li>
      <li><a href="http://127.0.0.1:5501/trabajo_LEO/pagina_404NOTFOUND/HTML/TP_tray/tp_Tray.HTML">Transporte</a></li>
      <li><a href="http://127.0.0.1:5501/trabajo_LEO/pagina_404NOTFOUND/HTML/Reportes_sugerencias_st/reportes.html">Reportes y sugerencias</a></li>
      <li><a href="http://127.0.0.1:5501/trabajo_LEO/pagina_404NOTFOUND/HTML/comunidad_st/comunidad.html">Comunidad</a></li>
      <li><a href="http://127.0.0.1:5501/trabajo_LEO/pagina_404NOTFOUND/HTML/panel_Admin_leo/Usuarios.html">Administración</a></li>
      <li><button id="BtnCerrarSesion" class="cerrarSesion">Cerrar Sesión</button></li>
    </ul>
  </div>
</header>

<div class="oscuro">
  <h1 class="BaseAzul">Transporte en Hacienda Vieja, Curridabat</h1>
  <p>Consulta rutas, horarios, consejos y ubicación de paradas cercanas a tu comunidad.</p>
</div>

<!-- Buscador -->
<div class="busqueda claro">
  <input type="text" id="buscadorRuta" placeholder="Buscar ruta, parada o destino..." />
  <br />
  <button class="boton margen" id="btnBuscar">Buscar</button>
</div>

<!-- Mapa Interactivo -->
<div class="claro">
  <h2 class="azul">Mapa de Paradas y Rutas</h2>
  <p>Visualiza en el siguiente mapa las paradas principales y rutas más utilizadas en Hacienda Vieja.</p>
  <iframe
    id="mapFrame"
    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3930.08950106349!2d-84.03100398500974!3d9.917647876191204!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8fa0e2bbf279e5df%3A0x6a1d7cfad788490b!2sHacienda%20Vieja%2C%20Curridabat!5e0!3m2!1ses-419!2scr!4v1710012345678"
    width="100%" height="400" allowfullscreen="" loading="lazy">
  </iframe>
</div>

<!-- Consejos útiles -->
<div class="oscuro">
  <h2 class="azul">Tips de Usuarios</h2>
  <ul>
    <li>Evita horas pico: 6:00 - 8:00 am y 4:30 - 6:30 pm.</li>
    <li>Lleva siempre cambio de baja denominación para el pasaje.</li>
    <li>Verifica el clima antes de salir, algunas paradas no tienen techo.</li>
    <li>Si tienes dudas, consulta con los choferes o vecinos.</li>
  </ul>
</div>

<!-- Opiniones comunitarias (dinámica) -->
<div class="claro">
  <h2 class="azul">Lo que opinan los vecinos</h2>

  <form id="frmOpinion" class="card" style="max-width:640px;margin:10px 0;">
    <div style="display:grid;gap:8px;">
      <input id="opNombre" type="text" placeholder="Tu nombre (opcional)">
      <select id="opCalif" aria-label="Calificación">
        <option value="5">★★★★★ (5)</option>
        <option value="4">★★★★☆ (4)</option>
        <option value="3">★★★☆☆ (3)</option>
        <option value="2">★★☆☆☆ (2)</option>
        <option value="1">★☆☆☆☆ (1)</option>
      </select>
      <input id="opRuta" type="text" placeholder="Ruta relacionada (opcional)">
      <textarea id="opComentario" rows="3" placeholder="Escribe tu opinión..." required></textarea>
      <button class="boton margen" type="submit">Publicar</button>
      <small>Tu opinión quedará <b>pendiente</b> hasta aprobación del administrador.</small>
    </div>
  </form>

  <div id="opinionesLista" class="contenedor-cartas"></div>
</div>


  <div id="opLista" class="contenedor-cartas"></div>
</div>

<!-- Botón flotante de ayuda -->
<a href="#" onclick="alert('¿Necesitás ayuda? Escribinos a transporte@comunidadconectada.ac.cr')" class="btn-ayuda"></a>

<!-- Footer -->
<footer>
  <a href="https://www.facebook.com/" class="fa fa-facebook" target="_blank"></a>
  <a href="https://www.instagram.com/" class="fa fa-instagram" target="_blank"></a>
  <a href="https://www.whatsapp.com/" class="fa fa-whatsapp" target="_blank"></a>
  <a href="tel:2222-2222" class="fa fa-phone"></a>
  <p>+(506) 2222-2222</p>
  <a href="mailto:info@comunidadconectada.ac.cr" class="fa fa-envelope"></a>
  <p>info@comunidadconectada.ac.cr</p><br>
  <p>&copy; Comunidad Conectada 2025. Todos los derechos reservados.</p>
</footer>
<script> document.addEventListener('DOMContentLoaded', async () => {
      const frm = $('#frmOpinion');
      const nombre = $('#opNombre');
      const califica = $('#opCalif');
      const ruta = $('#opRuta');
      const comentario = $('#opComentario');

      // Cargar solicitudes si ya hay email escrito (o luego de enviar)
      async function recargar() {
        try {
         // const data = await listarMisSolicitudes(email.value.trim());
         // renderSolicitudes(data);
         console.log("Debo actualizar las opiniones")
        } catch (e) {
          console.error(e);
        }
      }

      frm.addEventListener('submit', async (ev) => {
        ev.preventDefault();
        const payload = {
          nombre: nombre.value.trim(),
          ruta: email.value.trim(),
          calificacion: rol.value.trim(),
          comentario: motivo.value.trim()
        };
        if (!payload.nombre || !payload.ruta || !payload.calificacion || !payload.comentario) {
          return Swal.fire('Campos requeridos', 'Completá todos los campos.', 'info');
        }
        $('#btnEnviarSolicitud').disabled = true;
        try {
          await crearSolicitud(payload);
          await Swal.fire('¡Listo!', 'Tu opinion fue enviada y está en estado "pendiente".', 'success');
          frm.reset();
          await recargar();
        } catch (err) {
          console.error(err);
          Swal.fire('Error', 'No se pudo enviar la solicitud (puede que ya exista una pendiente con ese email y rol).', 'error');
        } finally {
          $('#btnEnviarSolicitud').disabled = false;
        }
      });

      // Al salir del email, carga sus solicitudes
      email.addEventListener('blur', recargar);
      // Carga inicial (por si ya viene con valor)
      recargar();
    });
</script>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script defer src="/trabajo_LEO/pagina_404NOTFOUND/js/cerrarSesion.js"></script>
<script defer src="/trabajo_LEO/pagina_404NOTFOUND/js/tp.JS"></script>
</body>
</html>